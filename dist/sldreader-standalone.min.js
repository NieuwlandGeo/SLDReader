var SLDReader=function(e,t,n,r,o,i,l,s,a,c,u,f,p,m,g,y){"use strict";const h="IMAGE_LOADING",d="IMAGE_LOADED",w="IMAGE_ERROR",b="PLACEMENT_FIRSTPOINT",k="PLACEMENT_LASTPOINT",x="metre",N="foot",S="pixel",P="none",E="comparison",C=["PropertyIsEqualTo","PropertyIsNotEqualTo","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo"],L=C.concat(["PropertyIsLike","PropertyIsNull","PropertyIsBetween"]);function I(e){return L.includes(e.localName)}function v(e){return["or","and"].includes(e.localName.toLowerCase())}function M(e,t){if(C.includes(e.localName))return z(e,t);if("PropertyIsBetween"===e.localName)return function(e,t){const n={type:E,operator:e.localName.toLowerCase(),matchcase:"false"!==e.getAttribute("matchCase")},r={};t(e,r,"expressions",{concatenateLiterals:!1}),r.expressions&&r.expressions.children&&(n.expression=r.expressions.children[0],n.lowerboundary=r.expressions.children[1],n.upperboundary=r.expressions.children[2]);return n}(e,t);if("PropertyIsNull"===e.localName)return function(e,t){const n={};return t(e,n,"expressions",{concatenateLiterals:!1}),{type:E,operator:e.localName.toLowerCase(),expression:n.expressions}}(e,t);if("PropertyIsLike"===e.localName)return function(e,t){const n=z(e,t);return{...n,wildcard:e.getAttribute("wildCard"),singlechar:e.getAttribute("singleChar"),escapechar:e.getAttribute("escapeChar")}}(e,t);throw new Error(`Unknown comparison element ${e.localName}`)}function z(e,t){const n={type:E,operator:e.localName.toLowerCase(),matchcase:"false"!==e.getAttribute("matchCase")},r={};return t(e,r,"expressions",{concatenateLiterals:!1}),r.expressions&&r.expressions.children&&(n.expression1=r.expressions.children[0],n.expression2=r.expressions.children[1]),n}function G(e,t){const n=[];for(let r=e.firstElementChild;r;r=r.nextElementSibling)r&&I(r)&&n.push(M(r,t)),r&&v(r)&&n.push(G(r,t)),r&&"not"===r.localName.toLowerCase()&&n.push(O(r,t));return{type:e.localName.toLowerCase(),predicates:n}}function O(e,t){let n=null;const r=e.firstElementChild;return r&&I(r)&&(n=M(r,t)),r&&v(r)&&(n=G(r,t)),r&&"not"===r.localName.toLowerCase()&&(n=O(r,t)),{type:e.localName.toLowerCase(),predicate:n}}const _=new Set(["strokeWidth","strokeOpacity","strokeDashoffset","fillOpacity","fontSize"]),A=new Set(["strokeOpacity","fillOpacity"]),T=/^data:image\/svg\+xml;base64,(.*)(\?.*)/,D=/param\(([^)]*)\)/g;function F(e,t,n,r){const o=n.toLowerCase();t[o]=t[o]||[];const i={};K(e,i,r),t[o].push(i)}function R(e,t,n){const r=n.toLowerCase();t[r]=t[r]||[];const o={type:"symbolizer"},i=e.getAttribute("uom");if(i)switch(i){case"http://www.opengeospatial.org/se/units/metre":o.uom=x;break;case"http://www.opengeospatial.org/se/units/foot":o.uom=N;break;case"http://www.opengeospatial.org/se/units/pixel":o.uom=S;break;default:console.warn("Unsupported uom attribute found, one of http://www.opengeospatial.org/se/units/(metre|feet|pixel) expected."),o.uom=S}else o.uom=S;K(e,o,{uom:o.uom}),t[r].push(o)}function $(e,t,n,r){const o=n.toLowerCase();t[o]={},K(e,t[o],r)}function H(e,t,n,r){const o=n.toLowerCase();r&&r.trimText?t[o]=e.textContent.trim():t[o]=e.textContent}function W(e,t,n){const r=n.toLowerCase(),o=parseFloat(e.textContent.trim());t[r]=o}function q(e,t,n){const r={...{skipEmptyNodes:!0,forceLowerCase:!0,typeHint:"string",concatenateLiterals:!0,uom:P},...arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}},o=[];for(let t=0;t<e.childNodes.length;t+=1){const n=e.childNodes[t],i={};if("http://www.opengis.net/ogc"===n.namespaceURI&&"PropertyName"===n.localName)i.type="propertyname",i.typeHint=r.typeHint,i.value=n.textContent.trim(),"number"!==i.typeHint||r.uom!==x&&r.uom!==N||(i.uom=r.uom);else if("http://www.opengis.net/ogc"===n.namespaceURI&&"Function"===n.localName){const e=n.getAttribute("name"),t=n.getAttribute("fallbackValue")||null;i.type="function",i.name=e,i.fallbackValue=t;const o={};q(n,o,"params",{...r,concatenateLiterals:!1}),Array.isArray(o.params.children)?i.params=o.params.children:i.params=[o.params]}else if("Add"===n.localName||"Sub"===n.localName||"Mul"===n.localName||"Div"===n.localName){i.type="function",i.name=`__fe:${n.localName}__`,i.typeHint="number";const e={};q(n,e,"params",{...r,concatenateLiterals:!1}),Array.isArray(e.params.children)?i.params=e.params.children:i.params=[e.params]}else"#cdata-section"===n.nodeName?(i.type="literal",i.typeHint=r.typeHint,i.value=n.textContent):n.nodeType!==Node.COMMENT_NODE&&(i.type="literal",i.typeHint=r.typeHint,i.value=n.textContent.trim());"literal"===i.type&&r.skipEmptyNodes?i.value.trim()&&o.push(i):o.push(i)}const i=r.forceLowerCase?n.toLowerCase():n;let l=function(e,t,n,r){if(!Array.isArray(e))return e;const o=e.map((e=>"literal"===e.type&&e.uom!==x&&e.uom!==N?e.value:e)).filter((e=>""!==e));if(n&&o.every((e=>"object"!=typeof e||null===e)))return o.join("");return 1===o.length?o[0]:{type:"expression",typeHint:t,uom:r,children:o}}(o,r.typeHint,r.concatenateLiterals,r.uom);if("string"==typeof l&&"number"===r.typeHint){const e=l.indexOf("px")>-1?S:r.uom;l=e===x||e===N?{type:"literal",typeHint:"number",value:parseFloat(l),uom:e}:parseFloat(l)}t[i]=l}function U(e,t,n){q(e,t,n,{...arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},typeHint:"number"})}function V(e,t,n){q(e,t,n,{...arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},typeHint:"number",uom:P})}function X(e,t){const n=e.getElementsByTagNameNS("http://www.opengis.net/sld",t);return!!n.length&&Boolean(n.item(0).textContent)}function Y(e,t,n,r,o){const i={...o};t[r]=t[r]||{};const l=e.getAttribute("name").toLowerCase().replace(/-(.)/g,((e,t)=>t.toUpperCase()));let s="string",a=i.uom;"styling"===r&&(_.has(l)&&(s="number"),A.has(l)&&(a=P)),q(e,t[r],l,{...o,skipEmptyNodes:!0,forceLowerCase:!1,typeHint:s,uom:a})}const j={Filter:(e,t)=>{t.filter=function(e,t){let n={};for(let r=e.firstElementChild;r;r=r.nextElementSibling)I(r)&&(n=M(r,t)),v(r)&&(n=G(r,t)),"not"===r.localName.toLowerCase()&&(n=O(r,t)),"featureid"===r.localName.toLowerCase()&&(n.type="featureid",n.fids=n.fids||[],n.fids.push(r.getAttribute("fid")));return n}(e,q)},ElseFilter:(e,t)=>{t.elsefilter=!0}},B={PolygonSymbolizer:R,LineSymbolizer:R,PointSymbolizer:R,TextSymbolizer:R,Fill:$,Stroke:$,GraphicStroke:$,GraphicFill:(e,t,n,r)=>$(e,t,n,{...r,uom:S}),Graphic:function(e,t,n,r){const o=n.toLowerCase();t[o]={},function(e,t,n){let r=!1;for(let o=e.firstElementChild;o;o=o.nextElementSibling)(!r||"Mark"!==o.localName&&"ExternalGraphic"!==o.localName)&&J[o.localName]&&(J[o.localName](o,t,o.localName,n),"Mark"!==o.localName&&"ExternalGraphic"!==o.localName||(r=!0))}(e,t[o],r)},ExternalGraphic:function(e,t,n,r){const o=n.toLowerCase();t[o]={},K(e,t[o],r);const i=t[o];if(i.onlineresource){if(i.onlineresource=i.onlineresource.trim(),/^base64:/.test(i.onlineresource)&&i.format){const e=`data:${i.format||""};base64,`,t=i.onlineresource.replace(/^base64:/,"");i.onlineresource=`${e}${t}`}if(T.test(i.onlineresource))try{const[,e,t]=i.onlineresource.match(T),n=window.atob(e),r=new URLSearchParams(t),o=n.replace(D,((e,t)=>r.get(t)||"")),l=window.btoa(o);i.onlineresource=`data:${i.format||""};base64,${l}`}catch(e){console.error("Error converting parametric SVG: ",e)}}},Format:H,Gap:U,InitialGap:U,Mark:$,Label:(e,t,n,r)=>q(e,t,n,{...r,skipEmptyNodes:!1}),Halo:$,Font:$,Radius:U,LabelPlacement:$,PointPlacement:$,LinePlacement:$,PerpendicularOffset:U,AnchorPoint:$,AnchorPointX:V,AnchorPointY:V,Opacity:V,Rotation:V,Displacement:$,DisplacementX:U,DisplacementY:U,Size:U,WellKnownName:H,MarkIndex:W,VendorOption:(e,t,n,r)=>Y(e,t,0,"vendoroptions",r),OnlineResource:(e,t)=>{t.onlineresource=e.getAttribute("xlink:href")},CssParameter:(e,t,n,r)=>Y(e,t,0,"styling",r),SvgParameter:(e,t,n,r)=>Y(e,t,0,"styling",r)},J={NamedLayer:(e,t)=>{F(e,t,"layers")},UserLayer:(e,t)=>{F(e,t,"layers")},UserStyle:(e,t)=>{t.styles=t.styles||[];const n={default:X(e,"IsDefault"),featuretypestyles:[]};K(e,n),t.styles.push(n)},FeatureTypeStyle:(e,t)=>{t.featuretypestyle=t.featuretypestyle||[];const n={rules:[]};K(e,n),t.featuretypestyles.push(n)},Rule:(e,t)=>{const n={};K(e,n),t.rules.push(n)},Name:H,Title:H,Abstract:H,Description:K,MaxScaleDenominator:W,MinScaleDenominator:W,...j,...B};function K(e,t,n){for(let r=e.firstElementChild;r;r=r.nextElementSibling)J[r.localName]&&J[r.localName](r,t,r.localName,n)}const Z=new Map;function Q(e,t){if("function"!=typeof t)throw new Error("Function implementation is not a function");Z[e]=t}function ee(e){return Z[e]||null}function te(e){if(e&&(e.uom===x||e.uom===N))return!0;switch((e||{}).type){case"expression":case"propertyname":case"function":return!0;default:return!1}}function ne(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=null;const i=typeof e;if("string"===i||"number"===i||"undefined"===i||"boolean"===i||null===e)o=e;else if("literal"===e.type)o=e.value;else if("propertyname"===e.type){const i=e.value;o=t?"function"==typeof t.getGeometryName&&i===t.getGeometryName()?t.getGeometry():n.getProperty(t,i):r}else if("expression"===e.type)if(1===e.children.length)o=ne(e.children[0],t,n,r);else{const r=[];for(let o=0;o<e.children.length;o+=1)r.push(ne(e.children[o],t,n,null));o=r.join("")}else if("function"===e.type){const r=ee(e.name);if(r)try{o=r(...e.params.map((e=>ne(e,t,n))))}catch{o=e.fallbackValue}else o=e.fallbackValue}if(0===o)return o;if((null==o||""===o||Number.isNaN(o))&&(o=r),e&&("number"===e.typeHint&&(o=Number(o),Number.isNaN(o)&&(o=r)),e.uom===N&&(o*=.3048),e.uom===x||e.uom===N)){o/=n?n.resolution:1}return o}function re(e){return null==e}function oe(e){return""===e?NaN:Number(e)}function ie(e,t,n){const r=oe(e),o=oe(t);if(!Number.isNaN(r)&&!Number.isNaN(o))return function(e,t){return e<t?-1:e===t?0:1}(r,o);const i=e.toString(),l=t.toString();return n?i.localeCompare(l):i.toLowerCase().localeCompare(l.toLowerCase())}function le(e,t,n){const r=ne(e.expression1,t,n);if(re(r))return!1;const o=ne(e.expression2,t,n);return!re(o)&&ie(r,o)<0}function se(e,t,n){const r=ne(e.expression1,t,n);if(re(r))return!1;const o=ne(e.expression2,t,n);return!re(o)&&ie(r,o)>0}function ae(e,t,n){const r=ne(e.expression1,t,n);if(re(r))return!1;const o=ne(e.expression2,t,n);return!re(o)&&(e.matchcase&&"boolean"!=typeof r&&"boolean"!=typeof o?r==o:0===ie(r,o,!1))}function ce(e,t,n){switch(e.operator){case"propertyislessthan":return le(e,t,n);case"propertyisequalto":return ae(e,t,n);case"propertyislessthanorequalto":return ae(e,t,n)||le(e,t,n);case"propertyisnotequalto":return function(e,t,n){return!re(ne(e.expression1,t,n))&&(!re(ne(e.expression2,t,n))&&!ae(e,t,n))}(e,t,n);case"propertyisgreaterthan":return se(e,t,n);case"propertyisgreaterthanorequalto":return ae(e,t,n)||se(e,t,n);case"propertyisbetween":return function(e,t,n){const r=ne(e.expression,t,n);if(re(r))return!1;const o=ne(e.lowerboundary,t,n);if(re(o))return!1;const i=ne(e.upperboundary,t,n);return!re(i)&&ie(o,r)<=0&&ie(i,r)>=0}(e,t,n);case"propertyisnull":return function(e,t,n){return re(ne(e.expression,t,n))}(e,t,n);case"propertyislike":return function(e,t,n){const r=ne(e.expression1,t,n);if(re(r))return!1;const o=ne(e.expression2,t,n);if(re(o))return!1;const{wildcard:i,singlechar:l,escapechar:s,matchcase:a}=e;let c=o.replace(new RegExp(`[${i}]`,"g"),".*");return c=c.replace(new RegExp(`[${l}]`,"g"),"."),"\\"!==s&&(c=c.replace(new RegExp(`[${s}]`,"g"),"\\")),c=`^${c}$`,(!1===a?new RegExp(c,"i"):new RegExp(c)).test(r)}(e,t,n);default:throw new Error(`Unkown comparison operator ${e.operator}`)}}function ue(e,t,n){const{type:r}=e;switch(r){case"featureid":return function(e,t){for(let n=0;n<e.length;n+=1)if(e[n]===t)return!0;return!1}(e.fids,n.getId(t));case"comparison":return ce(e,t,n);case"and":if(!e.predicates)throw new Error("And filter must have predicates array.");return 0!==e.predicates.length&&e.predicates.every((e=>ue(e,t,n)));case"or":if(!e.predicates)throw new Error("Or filter must have predicates array.");return e.predicates.some((e=>ue(e,t,n)));case"not":if(!e.predicate)throw new Error("Not filter must have predicate.");return!ue(e.predicate,t,n);default:throw new Error(`Unknown filter type: ${r}`)}}function fe(e,t){return void 0!==e.maxscaledenominator&&void 0!==e.minscaledenominator?t/28e-5<e.maxscaledenominator&&t/28e-5>e.minscaledenominator:void 0!==e.maxscaledenominator?t/28e-5<e.maxscaledenominator:void 0===e.minscaledenominator||t/28e-5>e.minscaledenominator}function pe(e,t,n){const r=[];let o=0;for(let i=0;i<e.rules.length;i+=1){const l=e.rules[i];fe(l,n.resolution)&&(l.elsefilter?(r.push(l),o+=1):l.filter?ue(l.filter,t,n)&&r.push(l):r.push(l))}return o===r.length?r:r.filter((e=>!e.elsefilter))}function me(e){return[...e.polygonsymbolizer||[],...e.linesymbolizer||[],...e.pointsymbolizer||[],...e.textsymbolizer||[]]}function ge(e,t){if(!e)return;let n=e;const r=(t||"").split(".");for(let e=0;e<r.length;e+=1){const t=r[e];if(!(t in n))return;n=n[t]}return n}function ye(e){const t={polygonSymbolizers:[],lineSymbolizers:[],pointSymbolizers:[],textSymbolizers:[]};return(e||[]).forEach((e=>{e.polygonsymbolizer&&(t.polygonSymbolizers=[...t.polygonSymbolizers,...e.polygonsymbolizer]),e.linesymbolizer&&(t.lineSymbolizers=[...t.lineSymbolizers,...e.linesymbolizer]),e.pointsymbolizer&&(t.pointSymbolizers=[...t.pointSymbolizers,...e.pointsymbolizer]),e.textsymbolizer&&(t.textSymbolizers=[...t.textSymbolizers,...e.textsymbolizer])})),t}const he=["graphic.externalgraphic","stroke.graphicstroke.graphic.externalgraphic","fill.graphicfill.graphic.externalgraphic"],de={};function we(e){return de[e]}const be={};function ke(e,t){be[e]=t}function xe(e){return be[e]}const Ne={};function Se(e,t){for(let n=0;n<he.length;n+=1){const r=he[n],o=ge(e,r);o&&o.onlineresource===t&&(e.__invalidated=!0,r.indexOf("graphicstroke")>-1&&(e.stroke.graphicstroke.__invalidated=!0))}}function Pe(e,t){if(e)if(Array.isArray(e))for(let n=0;n<e.length;n+=1)Se(e[n],t);else Se(e,t)}function Ee(e,t){e.rules&&e.rules.forEach((e=>{Pe(e.pointsymbolizer,t),Pe(e.linesymbolizer,t),Pe(e.polygonsymbolizer,t)}))}function Ce(e){let t=Ne[e];return t||(t=new Promise(((t,n)=>{const r=new Image;r.onload=()=>{!function(e,t){de[e]=t}(e,{url:e,image:r,width:r.naturalWidth,height:r.naturalHeight}),ke(e,d),t(e)},r.onerror=()=>{ke(e,w),n()},r.src=e})),ke(e,h),function(e,t){Ne[e]=t}(e,t),t)}function Le(e,t,n,r){e.forEach((e=>{me(e).forEach((e=>{he.forEach((o=>{const i=ge(e,o);if(!i)return;const l=i.onlineresource,s=xe(l);s&&s!==h||r[l]||(r[l]=!0,function(e,t,n){Ee(t,e),Ce(e).then((()=>{Ee(t,e),"function"==typeof n&&n(e)})).catch((()=>{Ee(t,e),"function"==typeof n&&n()}))}(l,t,n))}))}))}))}const Ie=new t({}),ve=new t({image:new i({radius:8,fill:new r({color:"blue",fillOpacity:.7})})}),Me=new t({image:new i({radius:5,fill:new r({color:"#DDDDDD"}),stroke:new o({width:1,color:"#888888"})})}),ze=new t({fill:new r({color:"#DDDDDD"}),stroke:new o({color:"#888888",width:1})}),Ge=new t({image:new l({angle:Math.PI/4,fill:new r({color:"red"}),points:4,radius:8,radius2:0,stroke:new o({color:"red",width:4})})}),Oe=new t({fill:new r({color:"red"}),stroke:new o({color:"red",width:1})});function _e(e){const t=new WeakMap;return n=>{let r=t.get(n);return r&&!n.__invalidated||(r=e(n),n.__invalidated=!1,t.set(n,r)),r}}function Ae(e,t){return null!==t&&t<1&&e.startsWith("#")?function(e,t){const n=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),o=parseInt(e.slice(5,7),16);return t||0===t?`rgba(${n}, ${r}, ${o}, ${t})`:`rgb(${n}, ${r}, ${o})`}(e,t):e}function Te(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const a=t/2,c=Math.PI*s/180;let u;switch(r&&r.getColor()&&(u=r.getColor()),e){case"circle":return new i({fill:r,radius:a,stroke:n});case"triangle":return new l({fill:r,points:3,radius:a,stroke:n,rotation:c});case"star":return new l({fill:r,points:5,radius:a,radius2:a/2.5,stroke:n,rotation:c});case"cross":return new l({fill:r,points:4,radius:a,radius2:0,stroke:n||new o({color:u,width:a/2}),rotation:c});case"hexagon":return new l({fill:r,points:6,radius:a,stroke:n||new o({color:u,width:a/2}),rotation:c});case"octagon":return new l({angle:Math.PI/8,fill:r,points:8,radius:a/Math.cos(Math.PI/8),stroke:n||new o({color:u,width:a/2}),rotation:c});case"cross2":case"x":return new l({angle:Math.PI/4,fill:r,points:4,radius:Math.sqrt(2)*a,radius2:0,stroke:n||new o({color:u,width:a/2}),rotation:c});case"diamond":return new l({fill:r,points:4,radius:a,stroke:n,rotation:c});case"horline":return new l({fill:r,points:2,radius:a,angle:Math.PI/2,stroke:n,rotation:c});case"line":return new l({fill:r,points:2,radius:a,angle:0,stroke:n,rotation:c});case"backslash":return new l({fill:r,points:2,radius:a*Math.sqrt(2),angle:-Math.PI/4,stroke:n,rotation:c});case"slash":return new l({fill:r,points:2,radius:a*Math.sqrt(2),angle:Math.PI/4,stroke:n,rotation:c});default:return new l({angle:Math.PI/4,fill:r,points:4,radius:a*Math.sqrt(2),stroke:n,rotation:c})}}function De(e){if(!e)return;const t=e?.styling,n=ne(t?.stroke,null,null,"#000000"),r=ne(t?.strokeOpacity,null,null,1),i=ne(t?.strokeWidth,null,null,1),l=ne(t?.strokeDashoffset,null,null,0),s={color:Ae(n,r),width:i,lineDashOffset:l},a=ne(t?.strokeLinejoin,null,null);null!==a&&(s.lineJoin=a);const c=ne(t?.strokeLinecap,null,null);null!==c&&(s.lineCap=c);const u=ne(t?.strokeDasharray,null,null);return null!==u&&(s.lineDash=u.split(" ")),new o(s)}function Fe(e){if(!e)return;const t=e?.styling,n=ne(t?.fill,null,null,"#808080"),o=ne(t?.fillOpacity,null,null,1);return new r({color:Ae(n,o)})}function Re(e,t,n,r){const o=e.getFill();if(!o)return!1;if(!r)return!1;let i=!1;const l=(t.fill||{}).styling||{};if(te(l.fill)||te(l.fillOpacity)){const e=ne(l.fill,n,r,"#808080"),t=ne(l.fillOpacity,n,r,1);o.setColor(Ae(e,t)),i=!0}return i}function $e(e,t,n,r){const o=e.getStroke();if(!o)return!1;if(!r)return!1;let i=!1;const l=t?.stroke?.styling;if(te(l?.strokeWidth)){const e=ne(l.strokeWidth,n,r,1);o.setWidth(e),i=!0}if(te(l?.stroke)||te(l?.strokeOpacity)){const e=ne(l.stroke,n,r,"#000000"),t=ne(l.strokeOpacity,n,r,1);o.setColor(Ae(e,t)),i=!0}return i}const He=Fe({styling:{fill:"#888888"}}),We=De({styling:{stroke:{}}});const qe=_e((function(e){const{graphic:r}=e;let o=ne(r.size,null,null,6);const i=ne(r.rotation,null,null,0);if(r?.externalgraphic?.onlineresource){r.size||(o=null);const e=r.externalgraphic.onlineresource;switch(xe(e)){case d:return function(e,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{image:i,width:l,height:s}=we(e);return new t({image:new n({img:i,imgSize:[l,s],scale:r/s||1,rotation:Math.PI*o/180})})}(e,o,i);case h:return Me;case w:return Ge;default:return Me}}if(r.mark){const{wellknownname:e}=r.mark,n=Fe(r?.mark?.fill),l=De(r?.mark?.stroke);return new t({image:Te(e,o,l,n,i)})}return new t({image:Te("square",o,We,He,i)})}));function Ue(e,t,n){if(!e?.graphic)return Ie;const r=qe(e);r.setGeometry(null);let o=r.getImage();const{graphic:i}=e,{size:l,rotation:s}=i,a=Number(ne(l,t,n))||6,c=Number(ne(s,t,n))||0;if(te(s)){const e=Math.PI*c/180;o.setRotation(e)}if(i.mark){$e(o,i.mark,t,n)&&o.setStroke(o.getStroke());Re(o,i.mark,t,n)&&o.setFill(o.getFill())}if(te(l))if(i?.externalgraphic?.onlineresource){const e=a/o.getSize()[1]||1;o.setScale(e)}else"circle"===i?.mark?.wellknownname?o.setRadius(.5*a):(o=Te(i?.mark?.wellknownname??"square",a,o.getStroke(),o.getFill(),c),r.setImage(o));const{displacement:u}=i;if(u){const{displacementx:e,displacementy:r}=u;if(void 0!==e||void 0!==r){const i=ne(e,t,n)||0,l=ne(r,t,n)||0;0===i&&0===l||o.setDisplacement([i,l])}}return r}function Ve(e,t){const n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}function Xe(e,t,n){const r=n/Ve(e,t);return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r]}function Ye(e,t,n){const r=t[0]-e[0],o=t[1]-e[1];return-Math.atan2(n?-o:o,r)}function je(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=Object.assign({minimumGraphicSpacing:0},n),o=e.getCoordinates();if(0===o.length)return[];if(1===o.length)return[[...o[0],0]];if(r.placement===b){const e=o[0],t=o[1];return[[e[0],e[1],Ye(e,t,r.invertY)]]}if(r.placement===k){const e=o[o.length-2],t=o[o.length-1];return[[t[0],t[1],Ye(e,t,r.invertY)]]}const i=e.getLength(),l=Math.max(t,r.minimumGraphicSpacing);let s=r.initialGap||0,a=0;const c=[...o[0]],f=[...o[1]];let p=0;const m=[];for(;s<=i;){const e=Ve(c,f);if(p+e<s){if(a===o.length-2)break;c[0]=f[0],c[1]=f[1],f[0]=o[a+2][0],f[1]=o[a+2][1],a+=1,p+=e}else{const e=Xe(c,f,s-p),t=Ye(c,f,r.invertY);r.extent&&!u.containsCoordinate(r.extent,e)||(e.push(t),m.push(e)),s+=l}}return m}function Be(e){const t=je(e,e.getLength()/2),[n,r]=t[1];return[n,r]}let Je=!1;function Ke(e,t,n,r,o,i){if(!t)return;if(Array.isArray(t[0][0]))return void t.forEach((t=>{Ke(e,t,n,r,o,i)}));if(t.length<2)return;const l=r.getImage();if(!l)return;je(new c(t),n*o,{invertY:!0,extent:e.extent_,placement:i.placement,initialGap:i.initialGap,minimumGraphicSpacing:.1}).forEach((t=>{const n=l.getRotation()+t[2];e.setImageStyle2(l,n),e.drawPoint(new a([t[0]/o,t[1]/o]))}))}function Ze(e){if(!e?.stroke?.graphicstroke)throw new Error("getGraphicStrokeRenderer error: symbolizer.stroke.graphicstroke null or undefined.");const{graphicstroke:t}=e.stroke,n={placement:"PLACEMENT_DEFAULT"};return e.vendoroptions&&("firstPoint"===e.vendoroptions.placement?n.placement=b:"lastPoint"===e.vendoroptions.placement&&(n.placement=k)),(r,o)=>{const i=o.feature.getGeometry().getType();if("Point"===i||"MultiPoint"===i)return;const l=o.pixelRatio||1,a=s.toContext(o.context);!function(e){if(Je)return;const t=Object.getPrototypeOf(e);t.setImageStyle2=function(e,n){t.setImageStyle.call(this,e),this.image_&&(this.imageRotation_=n)},Je=!0}(a);let c=6;t.graphic&&t.graphic.externalgraphic&&(c=16);const u=Ue(t,o.feature,null),f=Number(ne(t?.graphic?.size||c,o.feature,null,c)),p=function(e,t){const{graphicstroke:n,styling:r}=e.stroke;if("gap"in n)return n.gap+t;let o=1;if(r&&r.strokeDasharray){const e=r.strokeDasharray.split(" ");e.length>=2&&0!==e[0]&&(o=e[1]/e[0]+1)}return o*t}(e,f);n.initialGap=function(e){const{graphicstroke:t}=e.stroke;return t.initialgap||0}(e),Ke(a,r,p,u,l,n)}}const Qe=_e((function(e){return e?.stroke?.graphicstroke?function(e){if(!e?.stroke?.graphicstroke)throw new Error("getGraphicStrokeStyle error: linesymbolizer.stroke.graphicstroke null or undefined.");return new t({renderer:Ze(e)})}(e):new t({stroke:De(e?.stroke)})}));function et(e,t,n){const r=Qe(e);return $e(r,e,t,n),r}const tt=[[1,1]],nt=[[0,0],[2,2]],rt=[[0,0],[1,1],[2,2],[3,3],[2,0],[0,2]],ot=[[0,0],[1,1]];function it(e){const t=e.getContext("2d");if(1===f.DEVICE_PIXEL_RATIO)return t.createPattern(e,"repeat");const n=document.createElement("canvas");n.width=e.width*f.DEVICE_PIXEL_RATIO,n.height=e.height*f.DEVICE_PIXEL_RATIO;const r=n.getContext("2d");return r.imageSmoothingEnabled=!1,r.drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),r.createPattern(n,"repeat")}function lt(e,t,n){const r=document.createElement("canvas");r.width=e,r.height=e;const o=r.getContext("2d");return o.fillStyle=t,function(e,t){t.forEach((t=>{let[n,r]=t;e.fillRect(n,r,1,1)}))}(o,n),it(r)}function st(e,t,n){const r=document.createElement("canvas");r.width=e,r.height=e;const o=r.getContext("2d");return o.fillStyle=t,o.fillRect(0,0,e,e),function(e,t){t.forEach((t=>{let[n,r]=t;e.clearRect(n,r,1,1)}))}(o,n),it(r)}function at(e){const{image:t,width:n,height:r}=we(e.externalgraphic.onlineresource),o=document.createElement("canvas").getContext("2d");let i=f.DEVICE_PIXEL_RATIO;if(e.size&&r!==e.size&&(i*=e.size/r),1===i)return o.createPattern(t,"repeat");const l=document.createElement("canvas"),s=l.getContext("2d");return l.width=n*i,l.height=r*i,s.drawImage(t,0,0,n,r,0,0,n*i,r*i),o.createPattern(l,"repeat")}function ct(e){const{graphicfill:t}=e.fill,{graphic:n}=t,{mark:o}=n,{wellknownname:i}=o||{};if(i&&0===i.indexOf("brush://")){let e="#000000";return o.fill&&o.fill.styling&&o.fill.styling.fill&&(e=o.fill.styling.fill),function(e,t){let n=null;switch(e){case"brush://dense1":n=new r({color:st(4,t,tt)});break;case"brush://dense2":n=new r({color:st(4,t,nt)});break;case"brush://dense3":n=new r({color:st(4,t,rt)});break;case"brush://dense4":n=new r({color:lt(2,t,ot)});break;case"brush://dense5":n=new r({color:lt(4,t,rt)});break;case"brush://dense6":n=new r({color:lt(4,t,nt)});break;case"brush://dense7":n=new r({color:lt(4,t,tt)});break;default:n=new r({color:t})}return n}(i,e)}const l=Number(n.size)||6,c=l*f.DEVICE_PIXEL_RATIO;let u=null;try{const e=document.createElement("canvas");e.width=2*c,e.height=2*c;const n=e.getContext("2d"),o=function(e,t){if(!e.graphic)return e;const n=JSON.parse(JSON.stringify(e)),{graphic:r}=n,o=Number(r.size)||6;r.size=t*o;const{mark:i}=r;if(i&&i.stroke){i.stroke.styling||(i.stroke.styling={stroke:"#000000",strokeWidth:1}),i.stroke.styling.strokeWidth||(i.stroke.styling.strokeWidth=Number(i.stroke.styling.strokeWidth)||1);const e=i.stroke.styling.strokeWidth;e>1&&(i.stroke.styling.strokeWidth=t*e)}return n}(t,2),f=Ue(o),p=s.toContext(n,{size:[2*l,2*l]});n.imageSmoothingEnabled=!1,p.setStyle(f);const m=l/2*2,g=l/2*2;p.drawGeometry(new a([m,g])),i&&i.indexOf("slash")>-1&&(p.drawGeometry(new a([m-2*l,g])),p.drawGeometry(new a([m+2*l,g])),p.drawGeometry(new a([m,g-2*l])),p.drawGeometry(new a([m,g+2*l])));const y=document.createElement("canvas");y.width=c,y.height=c;const h=y.getContext("2d");h.drawImage(e,0,0,2*c,2*c,0,0,c,c);const d=h.createPattern(y,"repeat");u=new r({color:d})}catch{u=new r({color:"#000000"})}return u}const ut=_e((function(e){const n=e?.fill?.graphicfill?.graphic?.externalgraphic?.onlineresource,o=e?.fill?.graphicfill?.graphic?.mark;let i=null;if(i=n?function(e){const{graphic:t}=e.fill.graphicfill;switch(xe(t.externalgraphic.onlineresource)){case d:return new r({color:at(e.fill.graphicfill.graphic)});case h:return ze.getFill();case w:return Oe.getFill();default:return ze.getFill()}}(e):o?ct(e):Fe(e.fill),e?.stroke?.graphicstroke){const n=Ze(e);return new t({renderer:(e,t)=>{if(i){const{feature:n,context:r}=t,o=s.toContext(r);o.setFillStrokeStyle(i,void 0);const l=n.getGeometry().getType();"Polygon"===l?o.drawPolygon(new p(e)):"MultiPolygon"===l&&o.drawMultiPolygon(new m(e))}n(e,t)}})}const l=De(e.stroke);return new t({fill:i,stroke:l})}));function ft(e,t,n){const r=ut(e);return Re(r,e,t,n),$e(r,e,t,n),r}const pt=_e((function(e){if(!e?.label)return Ie;const n=ne(e.label,null,null,""),i=e?.font?.styling,l=ne(i?.fontFamily,null,null,"sans-serif"),s=ne(i?.fontSize,null,null,10),a=`${ne(i?.fontStyle,null,null,"")} ${ne(i?.fontWeight,null,null,"")} ${s}px ${l}`,c=e?.labelplacement?.pointplacement,u=ne(c?.rotation,null,null,0),f=c?.displacement,p=ne(f?.displacementx,null,null,0),m=-ne(f?.displacementy,null,null,0),y=c?.anchorpoint;let h="center";const d=ne(y?.anchorpointx,null,null,NaN);d<.25?h="left":d>.75&&(h="right");let w="middle";const b=ne(y?.anchorpointy,null,null,NaN);b<.25?w="bottom":b>.75&&(w="top");const k=e?.fill?.styling,x=ne(k?.fill,null,null,"#000000"),N=ne(k?.fillOpacity,null,null,1),S={text:n,font:a,offsetX:p,offsetY:m,rotation:Math.PI*u/180,textAlign:h,textBaseline:w,fill:new r({color:Ae(x,N)})};if(e.halo){const t=e?.halo?.fill?.styling,n=ne(t?.fill,null,null,"#FFFFFF"),r=ne(t?.fillOpacity,null,null,1),i=ne(e?.halo?.radius,null,null,1);S.stroke=new o({color:Ae(n,r),width:2*(2===i||4===i?i-1e-5:i)})}return new t({text:new g(S)})}));function mt(e,t,n){const r=pt(e),o=r.getText();if(!o)return r;const{label:i,labelplacement:l}=e;if(te(i)){const e=ne(i,t,n,"");o.setText(e.toString())}if(l){const e=l?.pointplacement?.rotation??0;if(te(e)){const r=ne(e,t,n,0);o.setRotation(Math.PI*r/180)}}const s=t.getGeometry?t.getGeometry():t.geometry,a=s.getType?s.getType():s.type,c=e?.labelplacement?.lineplacement,u="point"!==a&&c?"line":"point";o.setPlacement(u),function(e,t,n,r){const o=e.getText();if(!o)return!1;if(!r)return!1;(te(t?.fill?.styling?.fill)||te(t?.fill?.styling?.fillOpacity))&&$e(o,{stroke:{styling:{stroke:t?.fill?.styling?.fill,strokeOpacity:t?.fill?.styling?.fillOpacity}}},n,r);if((te(t?.halo?.fill?.styling?.fill)||te(t?.halo?.fill?.styling?.fillOpacity))&&Re(o,t.halo,n,r),te(t?.halo?.radius)){const e=ne(t.halo.radius,n,r,1),i=o.getStroke();if(i){const t=2*(2===e||4===e?e-1e-5:e);i.setWidth(t)}}}(r,e,t,n);const f=e?.font?.styling;if(f&&(te(f?.fontFamily)||te(f?.fontStyle)||te(f?.fontWeight)||te(f?.fontSize))){const e=ne(f?.fontFamily,t,n,"sans-serif"),r=`${ne(f?.fontStyle,t,n,"")} ${ne(f?.fontWeight,t,n,"")} ${ne(f?.fontSize,t,n,10)}px ${e}`;o.setFont(r)}return r}function gt(e,t,n){if("function"!=typeof t.getGeometry)return null;const r=t.getGeometry();if(!r)return null;let o=null;const i=r.getType();if("LineString"===i)o=Ue(e,t,n),o.setGeometry(new a(Be(r)));else if("MultiLineString"===i){const i=r.getLineStrings().map(Be);o=Ue(e,t,n),o.setGeometry(new y(i))}return o}function yt(e){const[t,n]=e.getInteriorPoint().getCoordinates();return[t,n]}function ht(e,t,n){if("function"!=typeof t.getGeometry)return null;const r=t.getGeometry();if(!r)return null;let o=null;const i=r.getType();if("Polygon"===i)o=Ue(e,t,n),o.setGeometry(new a(yt(r)));else if("MultiPolygon"===i){const i=r.getPolygons().map(yt);o=Ue(e,t,n),o.setGeometry(new y(i))}return o}const dt=[ve];function wt(e,t,n,r,o){(t||[]).forEach((t=>{const i=r(t,n,o);i&&e.push(i)}))}function bt(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{polygonSymbolizers:o,lineSymbolizers:i,pointSymbolizers:l,textSymbolizers:s}=e,a={strictGeometryMatch:!1,useFallbackStyles:!0,...r},c=t.getGeometry?t.getGeometry():t.geometry;let u=[];switch(c.getType?c.getType():c.type){case"Point":case"MultiPoint":wt(u,l,t,Ue,n),wt(u,s,t,mt,n);break;case"LineString":case"MultiLineString":wt(u,i,t,et,n),a.strictGeometryMatch||wt(u,l,t,gt,n),wt(u,s,t,mt,n);break;case"Polygon":case"MultiPolygon":wt(u,o,t,ft,n),a.strictGeometryMatch||wt(u,i,t,et,n),wt(u,l,t,ht,n),wt(u,s,t,mt,n);break;default:a.useFallbackStyles&&(u=dt)}return u.forEach(((e,t)=>e.setZIndex(t))),u}function kt(e){return e.getId()}function xt(e,t){return e.get(t)}function Nt(e){if(null===e)return"";const t=typeof e;switch(t){case"string":return e;case"number":case"bigint":case"boolean":return e.toString();case"undefined":return"";default:return t}}function St(e){return Nt(e).toLowerCase()}function Pt(e){return Nt(e).toUpperCase()}function Et(e,t,n){const r=Number(t),o=Number(n);if(Number.isNaN(r))return"";const i=Nt(e);return Number.isNaN(o)?r>0?i.slice(r-1):i.slice(r):0===o?"":r>0?o>0?i.slice(r-1,r-1+o):i.slice(r-1,o):o>0?r+o<0?i.slice(r,r+o):i.slice(r):i.slice(r,o)}function Ct(e,t,n){const r=Nt(e),o=Number(t),i=Number(n);return Number.isNaN(o)||Number.isNaN(i)?"":r.slice(o,i)}function Lt(e,t){const n=Nt(e),r=Number(t);return Number.isNaN(r)?"":n.slice(r)}function It(e){return e&&"function"==typeof e.getType?e.getType():"Unknown"}function vt(e){switch(It(e)){case"Point":case"MultiPoint":default:return 0;case"LineString":case"LinearRing":case"Circle":case"MultiLineString":return 1;case"Polygon":case"MultiPolygon":return 2}}function Mt(e){switch(It(e)){case"Point":case"MultiPoint":return"Point";case"LineString":case"LinearRing":case"Circle":case"MultiLineString":return"Line";case"Polygon":case"MultiPolygon":return"Polygon";default:return"Unknown"}}function zt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const[r,...o]=t,i=Nt(r);return o.some((e=>Nt(e)===i))}return function(){Q("lower",St),Q("upper",Pt),Q("geometry_type",Mt),Q("substr",Et),Q("strToLowerCase",St),Q("strToUpperCase",Pt),Q("strSubstring",Ct),Q("strSubstringStart",Lt),Q("geometryType",It),Q("dimension",vt),Q("in",zt);for(let e=2;e<=10;e+=1)Q(`in${e}`,zt);Q("__fe:Add__",((e,t)=>Number(e)+Number(t))),Q("__fe:Sub__",((e,t)=>Number(e)-Number(t))),Q("__fe:Mul__",((e,t)=>Number(e)*Number(t))),Q("__fe:Div__",((e,t)=>Number(e)/Number(t)))}(),e.OlStyler=bt,e.Reader=function(e){const t={},n=(new DOMParser).parseFromString(e,"application/xml").documentElement;return t.version=n.getAttribute("version"),K(n,t),t},e.categorizeSymbolizers=ye,e.createOlStyle=function(e,t){return bt(ye([e]),{geometry:{type:t}},(()=>null),{strictGeometryMatch:!0,useFallbackStyles:!1}).filter((e=>null!==e))},e.createOlStyleFunction=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t.imageLoadedCallback||(()=>{}),r={},o={};return o.getProperty="function"==typeof t.getProperty?t.getProperty:xt,o.getId=kt,(i,l)=>{const s="function"==typeof t.convertResolution?t.convertResolution(l):l;o.resolution=s;const a=pe(e,i,o);Le(a,e,n,r);return bt(ye(a),i,o)}},e.getByPath=ge,e.getFunction=ee,e.getLayer=function(e,t){return t?e.layers.find((e=>e.name===t)):e.layers[0]},e.getLayerNames=function(e){return e.layers.map((e=>e.name))},e.getRuleSymbolizers=me,e.getRules=pe,e.getStyle=function(e,t){if(t)return e.styles.find((e=>e.name===t));const n=e.styles.find((e=>e.default));return n||e.styles[0]},e.getStyleNames=function(e){return e.styles.map((e=>e.name))},e.registerFunction=Q,e.version="0.6.0",e}({},ol.style.Style,ol.style.Icon,ol.style.Fill,ol.style.Stroke,ol.style.Circle,ol.style.RegularShape,ol.render,ol.geom.Point,ol.geom.LineString,ol.extent,ol.has,ol.geom.Polygon,ol.geom.MultiPolygon,ol.style.Text,ol.geom.MultiPoint);
