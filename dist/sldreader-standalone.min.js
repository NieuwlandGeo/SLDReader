var SLDReader=function(e,t,n,r,o,i,l,s,a,c,u,f,p,m,g,y,h){"use strict";const d="IMAGE_LOADING",w="IMAGE_LOADED",b="IMAGE_ERROR",k="PLACEMENT_FIRSTPOINT",x="PLACEMENT_LASTPOINT",N="metre",S="foot",P="pixel",E="none",C="comparison",L=["PropertyIsEqualTo","PropertyIsNotEqualTo","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo"],I=L.concat(["PropertyIsLike","PropertyIsNull","PropertyIsBetween"]);function v(e){return I.includes(e.localName)}function M(e){return["or","and"].includes(e.localName.toLowerCase())}function z(e,t){if(L.includes(e.localName))return G(e,t);if("PropertyIsBetween"===e.localName)return function(e,t){const n={type:C,operator:e.localName.toLowerCase(),matchcase:"false"!==e.getAttribute("matchCase")},r={};t(e,r,"expressions",{concatenateLiterals:!1}),r.expressions&&r.expressions.children&&(n.expression=r.expressions.children[0],n.lowerboundary=r.expressions.children[1],n.upperboundary=r.expressions.children[2]);return n}(e,t);if("PropertyIsNull"===e.localName)return function(e,t){const n={};return t(e,n,"expressions",{concatenateLiterals:!1}),{type:C,operator:e.localName.toLowerCase(),expression:n.expressions}}(e,t);if("PropertyIsLike"===e.localName)return function(e,t){const n=G(e,t);return{...n,wildcard:e.getAttribute("wildCard"),singlechar:e.getAttribute("singleChar"),escapechar:e.getAttribute("escapeChar")}}(e,t);throw new Error(`Unknown comparison element ${e.localName}`)}function G(e,t){const n={type:C,operator:e.localName.toLowerCase(),matchcase:"false"!==e.getAttribute("matchCase")},r={};return t(e,r,"expressions",{concatenateLiterals:!1}),r.expressions&&r.expressions.children&&(n.expression1=r.expressions.children[0],n.expression2=r.expressions.children[1]),n}function O(e,t){const n=[];for(let r=e.firstElementChild;r;r=r.nextElementSibling)r&&v(r)&&n.push(z(r,t)),r&&M(r)&&n.push(O(r,t)),r&&"not"===r.localName.toLowerCase()&&n.push(_(r,t));return{type:e.localName.toLowerCase(),predicates:n}}function _(e,t){let n=null;const r=e.firstElementChild;return r&&v(r)&&(n=z(r,t)),r&&M(r)&&(n=O(r,t)),r&&"not"===r.localName.toLowerCase()&&(n=_(r,t)),{type:e.localName.toLowerCase(),predicate:n}}const T=new Set(["strokeWidth","strokeOpacity","strokeDashoffset","fillOpacity","fontSize"]),A=new Set(["strokeOpacity","fillOpacity"]),D=/^data:image\/svg\+xml;base64,(.*)(\?.*)/,F=/param\(([^)]*)\)/g;function R(e,t,n,r){const o=n.toLowerCase();t[o]=t[o]||[];const i={};Z(e,i,r),t[o].push(i)}function $(e,t,n){const r=n.toLowerCase();t[r]=t[r]||[];const o={type:"symbolizer"},i=e.getAttribute("uom");if(i)switch(i){case"http://www.opengeospatial.org/se/units/metre":o.uom=N;break;case"http://www.opengeospatial.org/se/units/foot":o.uom=S;break;case"http://www.opengeospatial.org/se/units/pixel":o.uom=P;break;default:console.warn("Unsupported uom attribute found, one of http://www.opengeospatial.org/se/units/(metre|feet|pixel) expected."),o.uom=P}else o.uom=P;Z(e,o,{uom:o.uom}),t[r].push(o)}function H(e,t,n,r){const o=n.toLowerCase();t[o]={},Z(e,t[o],r)}function W(e,t,n,r){const o=n.toLowerCase();r&&r.trimText?t[o]=e.textContent.trim():t[o]=e.textContent}function q(e,t,n){const r=n.toLowerCase(),o=parseFloat(e.textContent.trim());t[r]=o}function U(e,t,n){const r={...{skipEmptyNodes:!0,forceLowerCase:!0,typeHint:"string",concatenateLiterals:!0,uom:E},...arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}},o=[];for(let t=0;t<e.childNodes.length;t+=1){const n=e.childNodes[t],i={};if("http://www.opengis.net/ogc"===n.namespaceURI&&"PropertyName"===n.localName)i.type="propertyname",i.typeHint=r.typeHint,i.value=n.textContent.trim(),"number"!==i.typeHint||r.uom!==N&&r.uom!==S||(i.uom=r.uom);else if("http://www.opengis.net/ogc"===n.namespaceURI&&"Function"===n.localName){const e=n.getAttribute("name"),t=n.getAttribute("fallbackValue")||null;i.type="function",i.name=e,i.fallbackValue=t;const o={};U(n,o,"params",{...r,concatenateLiterals:!1}),Array.isArray(o.params.children)?i.params=o.params.children:i.params=[o.params]}else if("Add"===n.localName||"Sub"===n.localName||"Mul"===n.localName||"Div"===n.localName){i.type="function",i.name=`__fe:${n.localName}__`,i.typeHint="number";const e={};U(n,e,"params",{...r,concatenateLiterals:!1}),Array.isArray(e.params.children)?i.params=e.params.children:i.params=[e.params]}else"#cdata-section"===n.nodeName?(i.type="literal",i.typeHint=r.typeHint,i.value=n.textContent):n.nodeType!==Node.COMMENT_NODE&&(i.type="literal",i.typeHint=r.typeHint,i.value=n.textContent.trim());"literal"===i.type&&r.skipEmptyNodes?i.value.trim()&&o.push(i):o.push(i)}const i=r.forceLowerCase?n.toLowerCase():n;let l=function(e,t,n,r){if(!Array.isArray(e))return e;const o=e.map((e=>"literal"===e.type&&e.uom!==N&&e.uom!==S?e.value:e)).filter((e=>""!==e));if(n&&o.every((e=>"object"!=typeof e||null===e)))return o.join("");return 1===o.length?o[0]:{type:"expression",typeHint:t,uom:r,children:o}}(o,r.typeHint,r.concatenateLiterals,r.uom);if("string"==typeof l&&"number"===r.typeHint){const e=l.indexOf("px")>-1?P:r.uom;l=e===N||e===S?{type:"literal",typeHint:"number",value:parseFloat(l),uom:e}:parseFloat(l)}t[i]=l}function V(e,t,n){U(e,t,n,{...arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},typeHint:"number"})}function X(e,t,n){U(e,t,n,{...arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},typeHint:"number",uom:E})}function Y(e,t){const n=e.getElementsByTagNameNS("http://www.opengis.net/sld",t);return!!n.length&&Boolean(n.item(0).textContent)}function j(e,t,n,r,o){const i={...o};t[r]=t[r]||{};const l=e.getAttribute("name").toLowerCase().replace(/-(.)/g,((e,t)=>t.toUpperCase()));let s="string",a=i.uom;"styling"===r&&(T.has(l)&&(s="number"),A.has(l)&&(a=E)),U(e,t[r],l,{...o,skipEmptyNodes:!0,forceLowerCase:!1,typeHint:s,uom:a})}const B={Filter:(e,t)=>{t.filter=function(e,t){let n={};for(let r=e.firstElementChild;r;r=r.nextElementSibling)v(r)&&(n=z(r,t)),M(r)&&(n=O(r,t)),"not"===r.localName.toLowerCase()&&(n=_(r,t)),"featureid"===r.localName.toLowerCase()&&(n.type="featureid",n.fids=n.fids||[],n.fids.push(r.getAttribute("fid")));return n}(e,U)},ElseFilter:(e,t)=>{t.elsefilter=!0}},J={PolygonSymbolizer:$,LineSymbolizer:$,PointSymbolizer:$,TextSymbolizer:$,Fill:H,Stroke:H,GraphicStroke:H,GraphicFill:(e,t,n,r)=>H(e,t,n,{...r,uom:P}),Graphic:function(e,t,n,r){const o=n.toLowerCase();t[o]={},function(e,t,n){let r=!1;for(let o=e.firstElementChild;o;o=o.nextElementSibling)(!r||"Mark"!==o.localName&&"ExternalGraphic"!==o.localName)&&K[o.localName]&&(K[o.localName](o,t,o.localName,n),"Mark"!==o.localName&&"ExternalGraphic"!==o.localName||(r=!0))}(e,t[o],r)},ExternalGraphic:function(e,t,n,r){const o=n.toLowerCase();t[o]={},Z(e,t[o],r);const i=t[o];if(i.onlineresource){if(i.onlineresource=i.onlineresource.trim(),/^base64:/.test(i.onlineresource)&&i.format){const e=`data:${i.format||""};base64,`,t=i.onlineresource.replace(/^base64:/,"");i.onlineresource=`${e}${t}`}if(D.test(i.onlineresource))try{const[,e,t]=i.onlineresource.match(D),n=window.atob(e),r=new URLSearchParams(t),o=n.replace(F,((e,t)=>r.get(t)||"")),l=window.btoa(o);i.onlineresource=`data:${i.format||""};base64,${l}`}catch(e){console.error("Error converting parametric SVG: ",e)}}},Format:W,Gap:V,InitialGap:V,Mark:H,Label:(e,t,n,r)=>U(e,t,n,{...r,skipEmptyNodes:!1}),Halo:H,Font:H,Radius:V,LabelPlacement:H,PointPlacement:H,LinePlacement:H,PerpendicularOffset:V,AnchorPoint:H,AnchorPointX:X,AnchorPointY:X,Opacity:X,Rotation:X,Displacement:H,DisplacementX:V,DisplacementY:V,Size:V,WellKnownName:W,MarkIndex:q,VendorOption:(e,t,n,r)=>j(e,t,0,"vendoroptions",r),OnlineResource:(e,t)=>{t.onlineresource=e.getAttribute("xlink:href")},CssParameter:(e,t,n,r)=>j(e,t,0,"styling",r),SvgParameter:(e,t,n,r)=>j(e,t,0,"styling",r)},K={NamedLayer:(e,t)=>{R(e,t,"layers")},UserLayer:(e,t)=>{R(e,t,"layers")},UserStyle:(e,t)=>{t.styles=t.styles||[];const n={default:Y(e,"IsDefault"),featuretypestyles:[]};Z(e,n),t.styles.push(n)},FeatureTypeStyle:(e,t)=>{t.featuretypestyle=t.featuretypestyle||[];const n={rules:[]};Z(e,n),t.featuretypestyles.push(n)},Rule:(e,t)=>{const n={};Z(e,n),t.rules.push(n)},Name:W,Title:W,Abstract:W,Description:Z,MaxScaleDenominator:q,MinScaleDenominator:q,...B,...J};function Z(e,t,n){for(let r=e.firstElementChild;r;r=r.nextElementSibling)K[r.localName]&&K[r.localName](r,t,r.localName,n)}const Q=new Map;function ee(e,t){if("function"!=typeof t)throw new Error("Function implementation is not a function");Q[e]=t}function te(e){return Q[e]||null}function ne(e){if(null===e)return"";const t=typeof e;switch(t){case"string":return e;case"number":case"bigint":case"boolean":return e.toString();case"undefined":return"";default:return t}}function re(e){switch(e){case"Point":case"MultiPoint":return 0;case"LineString":case"LinearRing":case"Circle":case"MultiLineString":return 1;case"Polygon":case"MultiPolygon":return 2;default:return-1}}function oe(e){if(e&&(e.uom===N||e.uom===S))return!0;switch((e||{}).type){case"expression":case"propertyname":case"function":return!0;default:return!1}}function ie(e,n,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=null;const l=typeof e;if("string"===l||"number"===l||"undefined"===l||"boolean"===l||null===e)i=e;else if("literal"===e.type)i=e.value;else if("propertyname"===e.type){const t=e.value;i=n?"function"==typeof n.getGeometryName&&t===n.getGeometryName()?n.getGeometry():r.getProperty(n,t):o}else if("expression"===e.type)if(1===e.children.length)i=ie(e.children[0],n,r,o);else{const t=[];for(let o=0;o<e.children.length;o+=1)t.push(ie(e.children[o],n,r,null));i=t.join("")}else if("function"===e.type&&"dimension"===e.name&&n instanceof t)i=re(n.getType());else if("function"===e.type){const t=te(e.name);if(t)try{i=t(...e.params.map((e=>ie(e,n,r))))}catch{i=e.fallbackValue}else i=e.fallbackValue}if(0===i)return i;if((null==i||""===i||Number.isNaN(i))&&(i=o),e&&("number"===e.typeHint&&(i=Number(i),Number.isNaN(i)&&(i=o)),e.uom===S&&(i*=.3048),e.uom===N||e.uom===S)){i/=r?r.resolution:1}return i}function le(e){return null==e}function se(e){return""===e?NaN:Number(e)}function ae(e,t,n){const r=se(e),o=se(t);if(!Number.isNaN(r)&&!Number.isNaN(o))return function(e,t){return e<t?-1:e===t?0:1}(r,o);const i=e.toString(),l=t.toString();return n?i.localeCompare(l):i.toLowerCase().localeCompare(l.toLowerCase())}function ce(e,t,n){const r=ie(e.expression1,t,n);if(le(r))return!1;const o=ie(e.expression2,t,n);return!le(o)&&ae(r,o)<0}function ue(e,t,n){const r=ie(e.expression1,t,n);if(le(r))return!1;const o=ie(e.expression2,t,n);return!le(o)&&ae(r,o)>0}function fe(e,t,n){const r=ie(e.expression1,t,n);if(le(r))return!1;const o=ie(e.expression2,t,n);return!le(o)&&(e.matchcase&&"boolean"!=typeof r&&"boolean"!=typeof o?r==o:0===ae(r,o,!1))}function pe(e,t,n){switch(e.operator){case"propertyislessthan":return ce(e,t,n);case"propertyisequalto":return fe(e,t,n);case"propertyislessthanorequalto":return fe(e,t,n)||ce(e,t,n);case"propertyisnotequalto":return function(e,t,n){return!le(ie(e.expression1,t,n))&&(!le(ie(e.expression2,t,n))&&!fe(e,t,n))}(e,t,n);case"propertyisgreaterthan":return ue(e,t,n);case"propertyisgreaterthanorequalto":return fe(e,t,n)||ue(e,t,n);case"propertyisbetween":return function(e,t,n){const r=ie(e.expression,t,n);if(le(r))return!1;const o=ie(e.lowerboundary,t,n);if(le(o))return!1;const i=ie(e.upperboundary,t,n);return!le(i)&&ae(o,r)<=0&&ae(i,r)>=0}(e,t,n);case"propertyisnull":return function(e,t,n){return le(ie(e.expression,t,n))}(e,t,n);case"propertyislike":return function(e,t,n){const r=ie(e.expression1,t,n);if(le(r))return!1;const o=ie(e.expression2,t,n);if(le(o))return!1;const{wildcard:i,singlechar:l,escapechar:s,matchcase:a}=e;let c=o.replace(new RegExp(`[${i}]`,"g"),".*");return c=c.replace(new RegExp(`[${l}]`,"g"),"."),"\\"!==s&&(c=c.replace(new RegExp(`[${s}]`,"g"),"\\")),c=`^${c}$`,(!1===a?new RegExp(c,"i"):new RegExp(c)).test(r)}(e,t,n);default:throw new Error(`Unkown comparison operator ${e.operator}`)}}function me(e,t,n){const{type:r}=e;switch(r){case"featureid":return function(e,t){for(let n=0;n<e.length;n+=1)if(e[n]===t)return!0;return!1}(e.fids,n.getId(t));case"comparison":return pe(e,t,n);case"and":if(!e.predicates)throw new Error("And filter must have predicates array.");return 0!==e.predicates.length&&e.predicates.every((e=>me(e,t,n)));case"or":if(!e.predicates)throw new Error("Or filter must have predicates array.");return e.predicates.some((e=>me(e,t,n)));case"not":if(!e.predicate)throw new Error("Not filter must have predicate.");return!me(e.predicate,t,n);default:throw new Error(`Unknown filter type: ${r}`)}}function ge(e,t){return void 0!==e.maxscaledenominator&&void 0!==e.minscaledenominator?t/28e-5<e.maxscaledenominator&&t/28e-5>e.minscaledenominator:void 0!==e.maxscaledenominator?t/28e-5<e.maxscaledenominator:void 0===e.minscaledenominator||t/28e-5>e.minscaledenominator}function ye(e,t,n){const r=[];let o=0;for(let i=0;i<e.rules.length;i+=1){const l=e.rules[i];ge(l,n.resolution)&&(l.elsefilter?(r.push(l),o+=1):l.filter?me(l.filter,t,n)&&r.push(l):r.push(l))}return o===r.length?r:r.filter((e=>!e.elsefilter))}function he(e){return[...e.polygonsymbolizer||[],...e.linesymbolizer||[],...e.pointsymbolizer||[],...e.textsymbolizer||[]]}function de(e,t){if(!e)return;let n=e;const r=(t||"").split(".");for(let e=0;e<r.length;e+=1){const t=r[e];if(!(t in n))return;n=n[t]}return n}function we(e){const t={polygonSymbolizers:[],lineSymbolizers:[],pointSymbolizers:[],textSymbolizers:[]};return(e||[]).forEach((e=>{e.polygonsymbolizer&&(t.polygonSymbolizers=[...t.polygonSymbolizers,...e.polygonsymbolizer]),e.linesymbolizer&&(t.lineSymbolizers=[...t.lineSymbolizers,...e.linesymbolizer]),e.pointsymbolizer&&(t.pointSymbolizers=[...t.pointSymbolizers,...e.pointsymbolizer]),e.textsymbolizer&&(t.textSymbolizers=[...t.textSymbolizers,...e.textsymbolizer])})),t}const be=["graphic.externalgraphic","stroke.graphicstroke.graphic.externalgraphic","fill.graphicfill.graphic.externalgraphic"],ke={};function xe(e){return ke[e]}const Ne={};function Se(e,t){Ne[e]=t}function Pe(e){return Ne[e]}const Ee={};function Ce(e,t){for(let n=0;n<be.length;n+=1){const r=be[n],o=de(e,r);o&&o.onlineresource===t&&(e.__invalidated=!0,r.indexOf("graphicstroke")>-1&&(e.stroke.graphicstroke.__invalidated=!0))}}function Le(e,t){if(e)if(Array.isArray(e))for(let n=0;n<e.length;n+=1)Ce(e[n],t);else Ce(e,t)}function Ie(e,t){e.rules&&e.rules.forEach((e=>{Le(e.pointsymbolizer,t),Le(e.linesymbolizer,t),Le(e.polygonsymbolizer,t)}))}function ve(e){let t=Ee[e];return t||(t=new Promise(((t,n)=>{const r=new Image;r.onload=()=>{!function(e,t){ke[e]=t}(e,{url:e,image:r,width:r.naturalWidth,height:r.naturalHeight}),Se(e,w),t(e)},r.onerror=()=>{Se(e,b),n()},r.src=e})),Se(e,d),function(e,t){Ee[e]=t}(e,t),t)}function Me(e,t,n,r){e.forEach((e=>{he(e).forEach((e=>{be.forEach((o=>{const i=de(e,o);if(!i)return;const l=i.onlineresource,s=Pe(l);s&&s!==d||r[l]||(r[l]=!0,function(e,t,n){Ie(t,e),ve(e).then((()=>{Ie(t,e),"function"==typeof n&&n(e)})).catch((()=>{Ie(t,e),"function"==typeof n&&n()}))}(l,t,n))}))}))}))}const ze=new n({}),Ge=new n({image:new l({radius:8,fill:new o({color:"blue",fillOpacity:.7})})}),Oe=new n({image:new l({radius:5,fill:new o({color:"#DDDDDD"}),stroke:new i({width:1,color:"#888888"})})}),_e=new n({fill:new o({color:"#DDDDDD"}),stroke:new i({color:"#888888",width:1})}),Te=new n({image:new s({angle:Math.PI/4,fill:new o({color:"red"}),points:4,radius:8,radius2:0,stroke:new i({color:"red",width:4})})}),Ae=new n({fill:new o({color:"red"}),stroke:new i({color:"red",width:1})});function De(e){const t=new WeakMap;return n=>{let r=t.get(n);return r&&!n.__invalidated||(r=e(n),n.__invalidated=!1,t.set(n,r)),r}}function Fe(e,t){return null!==t&&t<1&&e.startsWith("#")?function(e,t){const n=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),o=parseInt(e.slice(5,7),16);return t||0===t?`rgba(${n}, ${r}, ${o}, ${t})`:`rgb(${n}, ${r}, ${o})`}(e,t):e}function Re(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const a=t/2,c=Math.PI*o/180;let u;switch(r&&r.getColor()&&(u=r.getColor()),e){case"circle":return new l({fill:r,radius:a,stroke:n});case"triangle":return new s({fill:r,points:3,radius:a,stroke:n,rotation:c});case"star":return new s({fill:r,points:5,radius:a,radius2:a/2.5,stroke:n,rotation:c});case"cross":return new s({fill:r,points:4,radius:a,radius2:0,stroke:n||new i({color:u,width:a/2}),rotation:c});case"hexagon":return new s({fill:r,points:6,radius:a,stroke:n||new i({color:u,width:a/2}),rotation:c});case"octagon":return new s({angle:Math.PI/8,fill:r,points:8,radius:a/Math.cos(Math.PI/8),stroke:n||new i({color:u,width:a/2}),rotation:c});case"cross2":case"x":return new s({angle:Math.PI/4,fill:r,points:4,radius:Math.sqrt(2)*a,radius2:0,stroke:n||new i({color:u,width:a/2}),rotation:c});case"diamond":return new s({fill:r,points:4,radius:a,stroke:n,rotation:c});case"horline":return new s({fill:r,points:2,radius:a,angle:Math.PI/2,stroke:n,rotation:c});case"line":return new s({fill:r,points:2,radius:a,angle:0,stroke:n,rotation:c});case"backslash":return new s({fill:r,points:2,radius:a*Math.sqrt(2),angle:-Math.PI/4,stroke:n,rotation:c});case"slash":return new s({fill:r,points:2,radius:a*Math.sqrt(2),angle:Math.PI/4,stroke:n,rotation:c});default:return new s({angle:Math.PI/4,fill:r,points:4,radius:a*Math.sqrt(2),stroke:n,rotation:c})}}function $e(e){if(!e)return;const t=e?.styling,n=ie(t?.stroke,null,null,"#000000"),r=ie(t?.strokeOpacity,null,null,1),o=ie(t?.strokeWidth,null,null,1),l=ie(t?.strokeDashoffset,null,null,0),s={color:Fe(n,r),width:o,lineDashOffset:l},a=ie(t?.strokeLinejoin,null,null);null!==a&&(s.lineJoin=a);const c=ie(t?.strokeLinecap,null,null);null!==c&&(s.lineCap=c);const u=ie(t?.strokeDasharray,null,null);return null!==u&&(s.lineDash=u.split(" ")),new i(s)}function He(e){if(!e)return;const t=e?.styling,n=ie(t?.fill,null,null,"#808080"),r=ie(t?.fillOpacity,null,null,1);return new o({color:Fe(n,r)})}function We(e,t,n,r){const o=e.getFill();if(!o)return!1;if(!r)return!1;let i=!1;const l=(t.fill||{}).styling||{};if(oe(l.fill)||oe(l.fillOpacity)){const e=ie(l.fill,n,r,"#808080"),t=ie(l.fillOpacity,n,r,1);o.setColor(Fe(e,t)),i=!0}return i}function qe(e,t,n,r){const o=e.getStroke();if(!o)return!1;if(!r)return!1;let i=!1;const l=t?.stroke?.styling;if(oe(l?.strokeWidth)){const e=ie(l.strokeWidth,n,r,1);o.setWidth(e),i=!0}if(oe(l?.stroke)||oe(l?.strokeOpacity)){const e=ie(l.stroke,n,r,"#000000"),t=ie(l.strokeOpacity,n,r,1);o.setColor(Fe(e,t)),i=!0}return i}const Ue=He({styling:{fill:"#888888"}}),Ve=$e({styling:{stroke:{}}});const Xe=De((function(e){const{graphic:t}=e;let o=ie(t.size,null,null,6);const i=ie(t.rotation,null,null,0);if(t?.externalgraphic?.onlineresource){t.size||(o=null);const e=t.externalgraphic.onlineresource;switch(Pe(e)){case w:return function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{image:i,width:l,height:s}=xe(e);return new n({image:new r({img:i,imgSize:[l,s],scale:t/s||1,rotation:Math.PI*o/180})})}(e,o,i);case d:return Oe;case b:return Te;default:return Oe}}if(t.mark){const{wellknownname:e}=t.mark,r=He(t?.mark?.fill),l=$e(t?.mark?.stroke);return new n({image:Re(e,o,l,r,i)})}return new n({image:Re("square",o,Ve,Ue,i)})}));function Ye(e,t,n){if(!e?.graphic)return ze;const r=Xe(e);r.setGeometry(null);let o=r.getImage();const{graphic:i}=e,{size:l,rotation:s}=i,a=Number(ie(l,t,n))||6,c=Number(ie(s,t,n))||0;if(oe(s)){const e=Math.PI*c/180;o.setRotation(e)}if(i.mark){qe(o,i.mark,t,n)&&o.setStroke(o.getStroke());We(o,i.mark,t,n)&&o.setFill(o.getFill())}if(oe(l))if(i?.externalgraphic?.onlineresource){const e=a/o.getSize()[1]||1;o.setScale(e)}else"circle"===i?.mark?.wellknownname?o.setRadius(.5*a):(o=Re(i?.mark?.wellknownname??"square",a,o.getStroke(),o.getFill(),c),r.setImage(o));const{displacement:u}=i;if(u){const{displacementx:e,displacementy:r}=u;if(void 0!==e||void 0!==r){const i=ie(e,t,n)||0,l=ie(r,t,n)||0;0===i&&0===l||o.setDisplacement([i,l])}}return r}function je(e,t){const n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}function Be(e,t,n){const r=n/je(e,t);return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r]}function Je(e,t,n){const r=t[0]-e[0],o=t[1]-e[1];return-Math.atan2(n?-o:o,r)}function Ke(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=Object.assign({minimumGraphicSpacing:0},n),o=e.getCoordinates();if(0===o.length)return[];if(1===o.length)return[[...o[0],0]];if(r.placement===k){const e=o[0],t=o[1];return[[e[0],e[1],Je(e,t,r.invertY)]]}if(r.placement===x){const e=o[o.length-2],t=o[o.length-1];return[[t[0],t[1],Je(e,t,r.invertY)]]}const i=e.getLength(),l=Math.max(t,r.minimumGraphicSpacing);let s=r.initialGap||0,a=0;const c=[...o[0]],u=[...o[1]];let p=0;const m=[];for(;s<=i;){const e=je(c,u);if(p+e<s){if(a===o.length-2)break;c[0]=u[0],c[1]=u[1],u[0]=o[a+2][0],u[1]=o[a+2][1],a+=1,p+=e}else{const e=Be(c,u,s-p),t=Je(c,u,r.invertY);r.extent&&!f.containsCoordinate(r.extent,e)||(e.push(t),m.push(e)),s+=l}}return m}function Ze(e){const t=Ke(e,e.getLength()/2),[n,r]=t[1];return[n,r]}let Qe=!1;function et(e,t,n,r,o,i){if(!t)return;if(Array.isArray(t[0][0]))return void t.forEach((t=>{et(e,t,n,r,o,i)}));if(t.length<2)return;const l=r.getImage();if(!l)return;Ke(new u(t),n*o,{invertY:!0,extent:e.extent_,placement:i.placement,initialGap:i.initialGap,minimumGraphicSpacing:.1}).forEach((t=>{const n=l.getRotation()+t[2];e.setImageStyle2(l,n),e.drawPoint(new c([t[0]/o,t[1]/o]))}))}function tt(e){if(!e?.stroke?.graphicstroke)throw new Error("getGraphicStrokeRenderer error: symbolizer.stroke.graphicstroke null or undefined.");const{graphicstroke:t}=e.stroke,n={placement:"PLACEMENT_DEFAULT"};return e.vendoroptions&&("firstPoint"===e.vendoroptions.placement?n.placement=k:"lastPoint"===e.vendoroptions.placement&&(n.placement=x)),(r,o)=>{const i=o.feature.getGeometry().getType();if("Point"===i||"MultiPoint"===i)return;const l=o.pixelRatio||1,s=a.toContext(o.context);!function(e){if(Qe)return;const t=Object.getPrototypeOf(e);t.setImageStyle2=function(e,n){t.setImageStyle.call(this,e),this.image_&&(this.imageRotation_=n)},Qe=!0}(s);let c=6;t.graphic&&t.graphic.externalgraphic&&(c=16);const u=Ye(t,o.feature,null),f=Number(ie(t?.graphic?.size||c,o.feature,null,c)),p=function(e,t){const{graphicstroke:n,styling:r}=e.stroke;if("gap"in n)return n.gap+t;let o=1;if(r&&r.strokeDasharray){const e=r.strokeDasharray.split(" ");e.length>=2&&0!==e[0]&&(o=e[1]/e[0]+1)}return o*t}(e,f);n.initialGap=function(e){const{graphicstroke:t}=e.stroke;return t.initialgap||0}(e),et(s,r,p,u,l,n)}}const nt=De((function(e){return e?.stroke?.graphicstroke?function(e){if(!e?.stroke?.graphicstroke)throw new Error("getGraphicStrokeStyle error: linesymbolizer.stroke.graphicstroke null or undefined.");return new n({renderer:tt(e)})}(e):new n({stroke:$e(e?.stroke)})}));function rt(e,t,n){const r=nt(e);return qe(r,e,t,n),r}const ot=[[1,1]],it=[[0,0],[2,2]],lt=[[0,0],[1,1],[2,2],[3,3],[2,0],[0,2]],st=[[0,0],[1,1]];function at(e){const t=e.getContext("2d");if(1===p.DEVICE_PIXEL_RATIO)return t.createPattern(e,"repeat");const n=document.createElement("canvas");n.width=e.width*p.DEVICE_PIXEL_RATIO,n.height=e.height*p.DEVICE_PIXEL_RATIO;const r=n.getContext("2d");return r.imageSmoothingEnabled=!1,r.drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),r.createPattern(n,"repeat")}function ct(e,t,n){const r=document.createElement("canvas");r.width=e,r.height=e;const o=r.getContext("2d");return o.fillStyle=t,function(e,t){t.forEach((t=>{let[n,r]=t;e.fillRect(n,r,1,1)}))}(o,n),at(r)}function ut(e,t,n){const r=document.createElement("canvas");r.width=e,r.height=e;const o=r.getContext("2d");return o.fillStyle=t,o.fillRect(0,0,e,e),function(e,t){t.forEach((t=>{let[n,r]=t;e.clearRect(n,r,1,1)}))}(o,n),at(r)}function ft(e){const{image:t,width:n,height:r}=xe(e.externalgraphic.onlineresource),o=document.createElement("canvas").getContext("2d");let i=p.DEVICE_PIXEL_RATIO;if(e.size&&r!==e.size&&(i*=e.size/r),1===i)return o.createPattern(t,"repeat");const l=document.createElement("canvas"),s=l.getContext("2d");return l.width=n*i,l.height=r*i,s.drawImage(t,0,0,n,r,0,0,n*i,r*i),o.createPattern(l,"repeat")}function pt(e){const{graphicfill:t}=e.fill,{graphic:n}=t,{mark:r}=n,{wellknownname:i}=r||{};if(i&&0===i.indexOf("brush://")){let e="#000000";return r.fill&&r.fill.styling&&r.fill.styling.fill&&(e=r.fill.styling.fill),function(e,t){let n=null;switch(e){case"brush://dense1":n=new o({color:ut(4,t,ot)});break;case"brush://dense2":n=new o({color:ut(4,t,it)});break;case"brush://dense3":n=new o({color:ut(4,t,lt)});break;case"brush://dense4":n=new o({color:ct(2,t,st)});break;case"brush://dense5":n=new o({color:ct(4,t,lt)});break;case"brush://dense6":n=new o({color:ct(4,t,it)});break;case"brush://dense7":n=new o({color:ct(4,t,ot)});break;default:n=new o({color:t})}return n}(i,e)}const l=Number(n.size)||6,s=l*p.DEVICE_PIXEL_RATIO;let u=null;try{const e=document.createElement("canvas");e.width=2*s,e.height=2*s;const n=e.getContext("2d"),r=function(e,t){if(!e.graphic)return e;const n=JSON.parse(JSON.stringify(e)),{graphic:r}=n,o=Number(r.size)||6;r.size=t*o;const{mark:i}=r;if(i&&i.stroke){i.stroke.styling||(i.stroke.styling={stroke:"#000000",strokeWidth:1}),i.stroke.styling.strokeWidth||(i.stroke.styling.strokeWidth=Number(i.stroke.styling.strokeWidth)||1);const e=i.stroke.styling.strokeWidth;e>1&&(i.stroke.styling.strokeWidth=t*e)}return n}(t,2),f=Ye(r),p=a.toContext(n,{size:[2*l,2*l]});n.imageSmoothingEnabled=!1,p.setStyle(f);const m=l/2*2,g=l/2*2;p.drawGeometry(new c([m,g])),i&&i.indexOf("slash")>-1&&(p.drawGeometry(new c([m-2*l,g])),p.drawGeometry(new c([m+2*l,g])),p.drawGeometry(new c([m,g-2*l])),p.drawGeometry(new c([m,g+2*l])));const y=document.createElement("canvas");y.width=s,y.height=s;const h=y.getContext("2d");h.drawImage(e,0,0,2*s,2*s,0,0,s,s);const d=h.createPattern(y,"repeat");u=new o({color:d})}catch{u=new o({color:"#000000"})}return u}const mt=De((function(e){const t=e?.fill?.graphicfill?.graphic?.externalgraphic?.onlineresource,r=e?.fill?.graphicfill?.graphic?.mark;let i=null;if(i=t?function(e){const{graphic:t}=e.fill.graphicfill;switch(Pe(t.externalgraphic.onlineresource)){case w:return new o({color:ft(e.fill.graphicfill.graphic)});case d:return _e.getFill();case b:return Ae.getFill();default:return _e.getFill()}}(e):r?pt(e):He(e.fill),e?.stroke?.graphicstroke){const t=tt(e);return new n({renderer:(e,n)=>{if(i){const{feature:t,context:r}=n,o=a.toContext(r);o.setFillStrokeStyle(i,void 0);const l=t.getGeometry().getType();"Polygon"===l?o.drawPolygon(new m(e)):"MultiPolygon"===l&&o.drawMultiPolygon(new g(e))}t(e,n)}})}const l=$e(e.stroke);return new n({fill:i,stroke:l})}));function gt(e,t,n){const r=mt(e);return We(r,e,t,n),qe(r,e,t,n),r}const yt=De((function(e){if(!e?.label)return ze;const t=ie(e.label,null,null,""),r=e?.font?.styling,l=ie(r?.fontFamily,null,null,"sans-serif"),s=ie(r?.fontSize,null,null,10),a=`${ie(r?.fontStyle,null,null,"")} ${ie(r?.fontWeight,null,null,"")} ${s}px ${l}`,c=e?.labelplacement?.pointplacement,u=ie(c?.rotation,null,null,0),f=c?.displacement,p=ie(f?.displacementx,null,null,0),m=-ie(f?.displacementy,null,null,0),g=c?.anchorpoint;let h="center";const d=ie(g?.anchorpointx,null,null,NaN);d<.25?h="left":d>.75&&(h="right");let w="middle";const b=ie(g?.anchorpointy,null,null,NaN);b<.25?w="bottom":b>.75&&(w="top");const k=e?.fill?.styling,x=ie(k?.fill,null,null,"#000000"),N=ie(k?.fillOpacity,null,null,1),S={text:t,font:a,offsetX:p,offsetY:m,rotation:Math.PI*u/180,textAlign:h,textBaseline:w,fill:new o({color:Fe(x,N)})};if(e.halo){const t=e?.halo?.fill?.styling,n=ie(t?.fill,null,null,"#FFFFFF"),r=ie(t?.fillOpacity,null,null,1),o=ie(e?.halo?.radius,null,null,1);S.stroke=new i({color:Fe(n,r),width:2*(2===o||4===o?o-1e-5:o)})}return new n({text:new y(S)})}));function ht(e,t,n){const r=yt(e),o=r.getText();if(!o)return r;const{label:i,labelplacement:l}=e;if(oe(i)){const e=ie(i,t,n,"");o.setText(e.toString())}if(l){const e=l?.pointplacement?.rotation??0;if(oe(e)){const r=ie(e,t,n,0);o.setRotation(Math.PI*r/180)}}const s=t.getGeometry?t.getGeometry():t.geometry,a=s.getType?s.getType():s.type,c=e?.labelplacement?.lineplacement,u="point"!==a&&c?"line":"point";o.setPlacement(u),function(e,t,n,r){const o=e.getText();if(!o)return!1;if(!r)return!1;(oe(t?.fill?.styling?.fill)||oe(t?.fill?.styling?.fillOpacity))&&qe(o,{stroke:{styling:{stroke:t?.fill?.styling?.fill,strokeOpacity:t?.fill?.styling?.fillOpacity}}},n,r);if((oe(t?.halo?.fill?.styling?.fill)||oe(t?.halo?.fill?.styling?.fillOpacity))&&We(o,t.halo,n,r),oe(t?.halo?.radius)){const e=ie(t.halo.radius,n,r,1),i=o.getStroke();if(i){const t=2*(2===e||4===e?e-1e-5:e);i.setWidth(t)}}}(r,e,t,n);const f=e?.font?.styling;if(f&&(oe(f?.fontFamily)||oe(f?.fontStyle)||oe(f?.fontWeight)||oe(f?.fontSize))){const e=ie(f?.fontFamily,t,n,"sans-serif"),r=`${ie(f?.fontStyle,t,n,"")} ${ie(f?.fontWeight,t,n,"")} ${ie(f?.fontSize,t,n,10)}px ${e}`;o.setFont(r)}return r}function dt(e,n,r){if("function"!=typeof n.getGeometry)return null;let o=n.getGeometry();if(!o)return null;o instanceof t&&(o=t.toGeometry(o));let i=null;const l=o.getType();if("LineString"===l)i=Ye(e,n,r),i.setGeometry(new c(Ze(o)));else if("MultiLineString"===l){const t=o.getLineStrings().map(Ze);i=Ye(e,n,r),i.setGeometry(new h(t))}return i}function wt(e){const[t,n]=e.getInteriorPoint().getCoordinates();return[t,n]}function bt(e,n,r){if("function"!=typeof n.getGeometry)return null;let o=n.getGeometry();if(!o)return null;o instanceof t&&(o=t.toGeometry(o));let i=null;const l=o.getType();if("Polygon"===l)i=Ye(e,n,r),i.setGeometry(new c(wt(o)));else if("MultiPolygon"===l){const t=o.getPolygons().map(wt);i=Ye(e,n,r),i.setGeometry(new h(t))}return i}const kt=[Ge];function xt(e,t,n,r,o){(t||[]).forEach((t=>{const i=r(t,n,o);i&&e.push(i)}))}function Nt(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{polygonSymbolizers:o,lineSymbolizers:i,pointSymbolizers:l,textSymbolizers:s}=e,a={strictGeometryMatch:!1,useFallbackStyles:!0,...r},c=t.getGeometry?t.getGeometry():t.geometry;let u=[];switch(c.getType?c.getType():c.type){case"Point":case"MultiPoint":xt(u,l,t,Ye,n),xt(u,s,t,ht,n);break;case"LineString":case"MultiLineString":xt(u,i,t,rt,n),a.strictGeometryMatch||xt(u,l,t,dt,n),xt(u,s,t,ht,n);break;case"Polygon":case"MultiPolygon":xt(u,o,t,gt,n),a.strictGeometryMatch||xt(u,i,t,rt,n),xt(u,l,t,bt,n),xt(u,s,t,ht,n);break;default:a.useFallbackStyles&&(u=kt)}return u.forEach(((e,t)=>e.setZIndex(t))),u}function St(e){return e.getId()}function Pt(e,t){return e.get(t)}function Et(e){return ne(e).toLowerCase()}function Ct(e){return ne(e).toUpperCase()}function Lt(e,t,n){const r=Number(t),o=Number(n);if(Number.isNaN(r))return"";const i=ne(e);return Number.isNaN(o)?r>0?i.slice(r-1):i.slice(r):0===o?"":r>0?o>0?i.slice(r-1,r-1+o):i.slice(r-1,o):o>0?r+o<0?i.slice(r,r+o):i.slice(r):i.slice(r,o)}function It(e,t,n){const r=ne(e),o=Number(t),i=Number(n);return Number.isNaN(o)||Number.isNaN(i)?"":r.slice(o,i)}function vt(e,t){const n=ne(e),r=Number(t);return Number.isNaN(r)?"":n.slice(r)}function Mt(e){return e&&"function"==typeof e.getType?e.getType():"Unknown"}function zt(e){return e?re(e.getType()):-1}function Gt(e){switch(Mt(e)){case"Point":case"MultiPoint":return"Point";case"LineString":case"LinearRing":case"Circle":case"MultiLineString":return"Line";case"Polygon":case"MultiPolygon":return"Polygon";default:return"Unknown"}}function Ot(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const[r,...o]=t,i=ne(r);return o.some((e=>ne(e)===i))}return function(){ee("lower",Et),ee("upper",Ct),ee("geometry_type",Gt),ee("substr",Lt),ee("strToLowerCase",Et),ee("strToUpperCase",Ct),ee("strSubstring",It),ee("strSubstringStart",vt),ee("geometryType",Mt),ee("dimension",zt),ee("in",Ot);for(let e=2;e<=10;e+=1)ee(`in${e}`,Ot);ee("__fe:Add__",((e,t)=>Number(e)+Number(t))),ee("__fe:Sub__",((e,t)=>Number(e)-Number(t))),ee("__fe:Mul__",((e,t)=>Number(e)*Number(t))),ee("__fe:Div__",((e,t)=>Number(e)/Number(t)))}(),e.OlStyler=Nt,e.Reader=function(e){const t={},n=(new DOMParser).parseFromString(e,"application/xml").documentElement;return t.version=n.getAttribute("version"),Z(n,t),t},e.categorizeSymbolizers=we,e.createOlStyle=function(e,t){return Nt(we([e]),{geometry:{type:t}},(()=>null),{strictGeometryMatch:!0,useFallbackStyles:!1}).filter((e=>null!==e))},e.createOlStyleFunction=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t.imageLoadedCallback||(()=>{}),r={},o={};return o.getProperty="function"==typeof t.getProperty?t.getProperty:Pt,o.getId=St,(i,l)=>{const s="function"==typeof t.convertResolution?t.convertResolution(l):l;o.resolution=s;const a=ye(e,i,o);Me(a,e,n,r);return Nt(we(a),i,o)}},e.getByPath=de,e.getFunction=te,e.getLayer=function(e,t){return t?e.layers.find((e=>e.name===t)):e.layers[0]},e.getLayerNames=function(e){return e.layers.map((e=>e.name))},e.getRuleSymbolizers=he,e.getRules=ye,e.getStyle=function(e,t){if(t)return e.styles.find((e=>e.name===t));const n=e.styles.find((e=>e.default));return n||e.styles[0]},e.getStyleNames=function(e){return e.styles.map((e=>e.name))},e.registerFunction=ee,e.version="0.6.1",e}({},ol.render.Feature,ol.style.Style,ol.style.Icon,ol.style.Fill,ol.style.Stroke,ol.style.Circle,ol.style.RegularShape,ol.render,ol.geom.Point,ol.geom.LineString,ol.extent,ol.has,ol.geom.Polygon,ol.geom.MultiPolygon,ol.style.Text,ol.geom.MultiPoint);
